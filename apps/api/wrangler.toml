name = "ronbun"
main = "src/index.ts"
compatibility_date = "2025-01-29"
compatibility_flags = ["nodejs_compat"]

[ai]
binding = "AI"

# ============================================================
# Production
# ============================================================
[env.production]

[[env.production.d1_databases]]
binding = "DB"
database_name = "ronbun-db"
database_id = "d0772c16-cfed-4d3a-928d-657bc6a0af1d"
migrations_dir = "../../migrations"

[[env.production.r2_buckets]]
binding = "STORAGE"
bucket_name = "ronbun-papers"

[[env.production.vectorize]]
binding = "VECTOR_INDEX"
index_name = "ronbun-embeddings"

[[env.production.queues.producers]]
binding = "INGEST_QUEUE"
queue = "ronbun-ingest"

[[env.production.queues.consumers]]
queue = "ronbun-ingest"
max_batch_size = 5
max_retries = 3
dead_letter_queue = "ronbun-ingest-dlq"

[[env.production.queues.producers]]
binding = "INGEST_DLQ"
queue = "ronbun-ingest-dlq"

[env.production.triggers]
crons = ["0 8 * * *"]

# ============================================================
# Preview
# ============================================================
[env.preview]

[[env.preview.d1_databases]]
binding = "DB"
database_name = "ronbun-db-preview"
database_id = "4fccbcbb-d681-4365-8cae-5408aab3d267"
migrations_dir = "../../migrations"

[[env.preview.r2_buckets]]
binding = "STORAGE"
bucket_name = "ronbun-papers-preview"

[[env.preview.vectorize]]
binding = "VECTOR_INDEX"
index_name = "ronbun-embeddings-preview"

[[env.preview.queues.producers]]
binding = "INGEST_QUEUE"
queue = "ronbun-ingest-preview"

[[env.preview.queues.consumers]]
queue = "ronbun-ingest-preview"
max_batch_size = 5
max_retries = 3
dead_letter_queue = "ronbun-ingest-dlq-preview"

[[env.preview.queues.producers]]
binding = "INGEST_DLQ"
queue = "ronbun-ingest-dlq-preview"
